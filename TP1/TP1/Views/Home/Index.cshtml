@model TP1.Models.LoginModel
@{
    ViewBag.Title = "My Todo List";
}
@functions{

    /// <summary>
    ///     The get anti forgery token.
    /// </summary>
    /// <returns>
    ///     The <see cref="string" />.
    /// </returns>
    public string GetAntiForgeryToken()
    {
        string cookieToken, formToken;
        AntiForgery.GetTokens(null, out cookieToken, out formToken);
        return cookieToken + ":" + formToken;
    }

}

<header>
    @Html.KnockoutHelperFor("SiteName", "h1")
</header>

<div id="main-content">
    @if (@User.Identity.IsAuthenticated)
    {
        <p class="error" data-bind="text: error"></p>
        <input id="antiForgeryToken" type="hidden" value="@GetAntiForgeryToken()" />
        <button data-bind="click: addTodoList">Add New Todo list</button>

        <section id="lists" data-bind="foreach: todoLists, visible: todoLists().length > 0">
            <article class="todoList">
                <header>
                    <form data-bind="validate: true">
                        <input class="required" data-bind="value: title, selected: isEditingListTitle, blurOnEnter: true" />
                    </form>
                </header>

                <a href="#" class="deletelist" data-bind="click: $parent.deleteTodoList">X</a>

                <ul data-bind="foreach: todos">
                    <li>
                        <input type="checkbox" data-bind="checked: isDone" />
                        <input class="todoItemInput" type="text" data-bind="value: title, disable: isDone, blurOnEnter: true" />
                        <a href="#" data-bind="click: $parent.deleteTodo">X</a>
                        <p class="error" data-bind="visible: errorMessage, text: errorMessage"></p>
                    </li>
                </ul>

                <form data-bind="submit: addTodo">
                    <input class="addTodo" type="text" data-bind="value: newTodoTitle, placeholder: 'Type here to add', blurOnEnter: true, event: { blur: addTodo }" />
                </form>

                <p class="error" data-bind="visible: errorMessage, text: errorMessage"></p>
            </article>
        </section>
    }
    else
    {
        <div class="todoList" id="loginPanel">
            <section id="localLoginPanel">
                @Html.KnockoutHelperFor("LogIn", "h2")  
                @Html.Partial("_Login")
            </section>
            <section id="socialLoginPanel">
                @Html.KnockoutHelperFor("AnotherLoginServiceTitle", "h2") 
                @Html.KnockoutHelperFor("AnotherLoginServiceText") 
              <!-- @Html.Action("ExternalLoginsList", "Account", new { ViewBag.ReturnUrl })-->
            </section>
            @Html.KnockoutHelperFor("FirstTimeHere", "p")  <a id="showRegister">@Html.KnockoutHelperFor("SignUp")</a>
        </div>
        <div class="todoList" id="registerPanel">
            <h2>Sign up</h2>
            @Html.Partial("_Register")
            @Html.KnockoutHelperFor("AlreadySignedUp", "p")  <a id="showLogin">@Html.KnockoutHelperFor("LogIn") </a>
        </div>
    }
</div>

@if (@User.Identity.IsAuthenticated)
{
@section scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/todo")
}}